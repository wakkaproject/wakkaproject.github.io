
<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="utf-8"/>
<title>„Éñ„É©„Ç¶„Ç∂„É°„É¢Â∏≥</title>
<style>
    body {
      margin: 0;
      font-family: Meiryo, sans-serif;
      display: flex;
      height: 100vh;
    }
    #tabs {
      width: 144px;
      background: #f2f2f2;
      border-right: 1px solid #ccc;
      overflow-y: auto;
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    .tab {
  height: 35px;
  font-size: 13px;
      background: white;
      border: 1px solid #ccc;
      margin-bottom: 5px;
      padding: 5px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .tab input {
      border: none;
      background: transparent;
      font-size: 11px;
      font-family: Meiryo;
      width: 100%;
    }
    .tab.active {
      background: var(--active-tab-color, #d6f0ff);
      font-weight: bold;
    }
    .tab-controls {
      margin-left: 6px;
      display: flex;
      gap: 4px;
    }
    .tab-controls span {
      cursor: pointer;
    }
    #addTab {
      padding: 5px;
      text-align: center;
      background: #ddffdd;
      border: 1px dashed #aaa;
      cursor: pointer;
      margin-bottom: 10px;
    }
    #editorArea {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    #editor {
      flex: 1;
      padding: 12px;
      font-family: Meiryo, sans-serif;
      font-size: 13px;
      letter-spacing: 0.05em;
      border: none;
      resize: none;
      outline: none;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
    }
    #controls {
      padding: 6px;
      border-top: 1px solid #ccc;
      text-align: right;
    }
    button {
      margin-left: 8px;
    }
  </style>
</head>
<body>
<div id="tabs">
<div id="addTab">Ôºã Êñ∞„Åó„ÅÑ<br/>„É°„É¢</div>
</div>
<div id="editorArea">
<textarea id="editor" placeholder="„Åì„Åì„Å´„É°„É¢„ÇíÂÖ•Âäõ..."></textarea>
<div id="controls"><button onclick="copyFormattedText()">REC ChatÊÉÖÂ†±„Ç≥„Éî„Éº</button>
<button onclick="saveAsTxt()">‰øùÂ≠òÔºà.txtÔºâ</button>
<input accept=".txt" id="fileInput" onchange="loadFromTxt(event)" style="display:none" type="file"/>
<button onclick="document.getElementById('fileInput').click()">Ë™≠ËæºÔºà.txtÔºâ</button>
</div>
</div>
<script>
let tabs = JSON.parse(localStorage.getItem("tabs")) || [{name:"„É°„É¢1", content:"", color:"#e6fff9"}];
let currentTab = 0;

const tabsContainer = document.getElementById("tabs");
const editor = document.getElementById("editor");
const addTabBtn = document.getElementById("addTab");

function renderTabs() {
  [...tabsContainer.querySelectorAll(".tab")].forEach(e => e.remove());
  tabs.forEach((tab, index) => {
    const div = document.createElement("div");
    div.className = "tab" + (index === currentTab ? " active" : "");
    div.style.background = index === currentTab ? "#d6f0ff" : "white";

    div.draggable = true;
    const deleteBtn = document.createElement("span");
    deleteBtn.textContent = "‚ùå";
    deleteBtn.title = "ÂâäÈô§";
    deleteBtn.style.marginRight = "6px";
    deleteBtn.onclick = e => {
      e.stopPropagation();
      tabs.splice(index, 1);
      if (currentTab >= index) currentTab = Math.max(0, currentTab - 1);
      saveTabs();
      renderTabs();
      loadCurrent();
    };

    const input = document.createElement("input");
    input.value = tab.name;
    input.onchange = () => {
      tab.name = input.value;
      saveTabs();
    };
    input.onclick = e => e.stopPropagation();

    const switchBtn = document.createElement("span");
    switchBtn.textContent = "üìÑ";
    switchBtn.title = "Ë°®Á§∫";
    switchBtn.style.padding = "6px 10px";
    switchBtn.style.border = "1px solid #aaa";
    switchBtn.style.borderRadius = "4px";
    switchBtn.style.background = "#eef";
    switchBtn.style.marginLeft = "6px";
    switchBtn.style.cursor = "pointer";
    switchBtn.onclick = e => {
      e.stopPropagation();
      saveCurrent();
      currentTab = index;
      renderTabs();
      loadCurrent();
    };

    const controls = document.createElement("div");
    controls.className = "tab-controls";
    controls.appendChild(switchBtn);

    div.appendChild(deleteBtn);
    div.appendChild(input);
    div.appendChild(controls);

    div.addEventListener("dragstart", e => {
      e.dataTransfer.setData("index", index);
    });
    div.addEventListener("dragover", e => e.preventDefault());
    div.addEventListener("drop", e => {
      const fromIndex = +e.dataTransfer.getData("index");
      if (fromIndex !== index) {
        const moved = tabs.splice(fromIndex, 1)[0];
        tabs.splice(index, 0, moved);
        if (currentTab === fromIndex) currentTab = index;
        saveTabs();
        renderTabs();
      }
    });

    tabsContainer.insertBefore(div, addTabBtn.nextSibling);
  });
}

function saveTabs() {
  localStorage.setItem("tabs", JSON.stringify(tabs));
}

function saveCurrent() {
  if (tabs[currentTab]) {
    tabs[currentTab].content = editor.value;
    saveTabs();
  }
}

function loadCurrent() {
  editor.value = tabs[currentTab]?.content || "";
  document.getElementById("editorArea").style.background = "#d6f0ff";
}

addTabBtn.onclick = () => {
  saveCurrent();
  const availableColors = ['#e6fff9', '#f0e6ff', '#f2ffe6', '#ffe6fa', '#e6ffe6', '#e6fef9', '#ffe6e6', '#fff0e6', '#e6e6ff', '#ffe6f0', '#e6f7ff', '#e6f2ff', '#e6fff0', '#fef9e6', '#fff0f7', '#f9e6ff', '#e6fffa', '#f6e6ff', '#fde6ff', '#fffbe6'].filter(c => !tabs.some(t => t.color === c));
  const color = availableColors[0] || "#ffffff";
  tabs.unshift({name: "„É°„É¢" + (tabs.length + 1), content: "", color});
  currentTab = 0;
  saveTabs();
  renderTabs();
  loadCurrent();
};

editor.addEventListener("input", () => {
  saveCurrent();
});

function saveAsTxt() {
  const blob = new Blob([editor.value], { type: "text/plain" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = tabs[currentTab].name + ".txt";
  link.click();
}

function loadFromTxt(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(event) {
    editor.value = event.target.result;
    saveCurrent();
  };
  reader.readAsText(file);
}

window.addEventListener("beforeunload", saveCurrent);
renderTabs();
loadCurrent();
</script><script>
function copyFormattedText() {
  const text = editor.value;
  const lines = text.split('\n');

  const aliasMap = {
    "TAG#": ["TAG", "TAG#", "„ÉªTAG"],
    "CASE#": ["CASE", "CASE#", "„ÉªCASE"],
    "Ê©üÁ®ÆÂêçÔºö": ["Ê©üÁ®ÆÂêç", "Ê©üÁ®ÆÂêçÔºö", "Ê©üÁ®ÆÔºö", "Ê©üÁ®Æ"],
    "DTC‰ΩøÁî®ÊúâÁÑ°Ôºö": ["DTC", "DTC‰ΩøÁî®", "DTC‰ΩøÁî®ÊúâÁÑ°", "DTCÔºö"],
    "Á∂ôÁ∂öTranscript#": ["Á∂ôÁ∂öTranscript#", "Á∂ôÁ∂öTranscript"],
    "Ê©üÁ®Æ:": ["Ê©üÁ®Æ:"],
    "ËÅû„Åç„Åü„ÅÑ„Åì„Å®:": ["ËÅû„Åç„Åü„ÅÑ„Åì„Å®:", "ËÅû„Åç„Åü„ÅÑ‰∫ã", "ËÅû„Åç„Åü„ÅÑ„Åì„Å®"],
    "ÂõûÁ≠î„É™„Éü„ÉÉ„ÉàÊôÇÈñìÔºö": ["ÂõûÁ≠î„É™„Éü„ÉÉ„Éà", "ÂõûÁ≠î„É™„Éü„ÉÉ„ÉàÊôÇÈñìÔºö"],
    "OSÊÉÖÂ†±:": ["OS", "OS:", "OSÊÉÖÂ†±:"],
    "ÁèæË±°:": ["ÁèæË±°", "ÁèæË±°:"],
    "„ÅÑ„Å§„Åã„Çâ:": ["„ÅÑ„Å§„Åã„Çâ", "„ÅÑ„Å§„Åã„Çâ:"],
    "È†ªÂ∫¶:": ["È†ªÂ∫¶", "È†ªÂ∫¶:"],
    "ÂÆüÊñΩ„Åó„ÅüÂàá„ÇäÂàÜ„Åë:": ["ÂÆüÊñΩ„Åó„ÅüÂàá„ÇäÂàÜ„Åë", "ÂÆüÊñΩÂàá„ÇäÂàÜ„Åë", "ÂÆüÊñΩ„Åó„ÅüÂàá„ÇäÂàÜ„Åë:"]
  };

  const fields = {};
  let currentKey = null;

  for (let line of lines) {
    let trimmed = line.trim();
    if (trimmed.startsWith("‚ñ†") || trimmed.startsWith("„Éª")) {
      trimmed = trimmed.replace(/^‚ñ†|^„Éª/, "");
      let matched = false;
      for (const [key, patterns] of Object.entries(aliasMap)) {
        if (patterns.some(p => trimmed.startsWith(p))) {
          currentKey = key;
          fields[key] = trimmed.replace(patterns.find(p => trimmed.startsWith(p)), "").trim();
          matched = true;
          break;
        }
      }
      if (!matched && currentKey) {
        fields[currentKey] += "\n" + trimmed;
      }
    } else if (currentKey) {
      fields[currentKey] += "\n" + trimmed;
    }
  }

  const get = k => fields[k] || "";

  const formatted = 
`‚ñ†‰øùÂÆàÁ¢∫Ë™çÔºÅ
‚ñ†TAG#${get("TAG#")}
‚ñ†CASE#${get("CASE#")}
‚ñ†Ê©üÁ®ÆÂêç:${get("Ê©üÁ®ÆÂêçÔºö")}
‚ñ†ËÅû„Åç„Åü„ÅÑ‰∫ã:${get("ËÅû„Åç„Åü„ÅÑ„Åì„Å®:")}
‚ñ†ÁêÜÁî±/ËÉåÊôØÔºö
‚ñ†OSÊÉÖÂ†±:${get("OSÊÉÖÂ†±:")}
‚ñ†ÁèæË±°:${get("ÁèæË±°:")}
‚ñ†„ÅÑ„Å§„Åã„Çâ:${get("„ÅÑ„Å§„Åã„Çâ:")}
‚ñ†È†ªÂ∫¶:${get("È†ªÂ∫¶:")}
‚ñ†„Åù„ÅÆ‰ªñÊÉÖÂ†±:
„ÄêÂÆüÊñΩ„Åó„ÅüÂàá„ÇäÂàÜ„Åë„Äë
${get("ÂÆüÊñΩ„Åó„ÅüÂàá„ÇäÂàÜ„Åë:")}`;

  navigator.clipboard.writeText(formatted).then(() => {
    const btn = document.querySelector('button[onclick="copyFormattedText()"]'); if (btn) { const original = btn.textContent; btn.textContent = "Copied!"; setTimeout(() => { btn.textContent = original; }, 1500); }
  });
}
</script></body>
</html>
